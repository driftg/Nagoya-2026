<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>北海道自駕遊 Hokkaido Trip</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'hokkaido-bg': '#F0F4F8', // 雪地灰白
                        'ice-blue': '#D6E4F0', // 淺冰藍
                        'deep-sea': '#1E3A8A', // 深海藍
                        'snow-white': '#FFFFFF',
                    },
                    fontFamily: {
                        sans: ['Noto Sans TC', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        /* 隱藏滾動條但保留功能 (App質感) */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        body {
            background-color: #F0F4F8; /* 延伸背景色 */
        }
        /* 頁首圓弧與負邊距設計 */
        .header-curve {
            border-bottom-left-radius: 40px;
            border-bottom-right-radius: 40px;
            overflow: hidden;
            position: relative;
            z-index: 10;
        }
        .content-pull-up {
            margin-top: -30px; /* 向上拉動 */
            position: relative;
            z-index: 20;
        }
    </style>
</head>
<body class="text-slate-600 antialiased selection:bg-blue-200">

    <div id="app" class="max-w-md mx-auto bg-hokkaido-bg min-h-screen shadow-2xl relative overflow-hidden">
        
        <header class="header-curve h-[250px] relative shadow-lg">
            <img :src="bannerImage" class="w-full h-full object-cover object-center" alt="Hokkaido Banner">
            
            <div class="absolute inset-0 bg-gradient-to-t from-blue-900/60 to-transparent"></div>

            <div class="absolute bottom-4 right-4 flex space-x-3 z-30">
                <button v-for="tab in tabs" :key="tab.id" 
                    @click="currentTab = tab.id"
                    :class="['flex flex-col items-center justify-center w-14 h-14 rounded-2xl backdrop-blur-md border border-white/30 transition-all duration-300 shadow-lg', 
                             currentTab === tab.id ? 'bg-white/90 text-blue-600 scale-110' : 'bg-black/20 text-white hover:bg-white/40']">
                    <i :class="tab.icon + ' text-xl mb-1'"></i>
                    <span class="text-[10px] font-bold">{{ tab.name }}</span>
                </button>
            </div>
            
            <div class="absolute top-8 left-6 text-white drop-shadow-md">
                <h1 class="text-3xl font-bold tracking-widest">HOKKAIDO</h1>
                <p class="text-sm opacity-90 tracking-wider">Family Trip 2025</p>
            </div>
        </header>

        <main class="content-pull-up px-4 pb-24">
            
            <div v-if="currentTab === 'itinerary'" class="animate-fade-in">
                
                <div class="flex overflow-x-auto no-scrollbar space-x-3 py-4 mb-2">
                    <div v-for="(day, index) in tripDays" :key="index" 
                         @click="selectedDayIndex = index"
                         :class="['flex-shrink-0 flex flex-col items-center justify-center w-16 h-20 rounded-2xl cursor-pointer transition-all shadow-sm', 
                                  selectedDayIndex === index ? 'bg-blue-600 text-white shadow-blue-300' : 'bg-white text-slate-400']">
                        <span class="text-xs font-medium uppercase">{{ day.weekday }}</span>
                        <span class="text-2xl font-bold">{{ day.date }}</span>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-blue-400 to-blue-300 rounded-2xl p-4 text-white mb-4 flex items-center justify-between shadow-md">
                    <div>
                        <div class="text-sm opacity-90"><i class="fas fa-map-marker-alt mr-1"></i> {{ weatherData.location }}</div>
                        <div class="text-xs mt-1">體感 {{ weatherData.feelsLike }}°C</div>
                    </div>
                    <div class="flex items-center">
                        <span class="text-4xl font-bold mr-3">{{ weatherData.temp }}°</span>
                        <div class="text-center">
                            <i :class="weatherData.icon + ' text-2xl'"></i>
                            <div class="text-xs">{{ weatherData.desc }}</div>
                        </div>
                    </div>
                </div>

                <div class="flex justify-end mb-4">
                    <select v-model="filterType" class="bg-white border-none text-sm text-slate-500 rounded-full px-4 py-2 shadow-sm focus:ring-2 focus:ring-blue-200 outline-none">
                        <option value="all">顯示全部</option>
                        <option value="flight">航班</option>
                        <option value="spot">景點</option>
                        <option value="food">美食</option>
                        <option value="hotel">住宿</option>
                        <option value="shopping">購物</option>
                    </select>
                </div>

                <div class="space-y-0"> <template v-for="(item, index) in filteredItinerary" :key="item.id">
                        
                        <div v-if="index > 0 || (index === 0 && selectedDayIndex > 0)" class="flex justify-center items-center py-3 opacity-60">
                            <div class="h-8 w-px bg-slate-300"></div>
                            <div class="mx-3 flex items-center text-xs bg-slate-200 px-3 py-1 rounded-full text-slate-500">
                                <i :class="getTransportIcon(item.transportType) + ' mr-1'"></i>
                                <span>{{ item.transportTime }}</span>
                            </div>
                            <div class="h-8 w-px bg-slate-300"></div>
                        </div>

                        <div class="group relative bg-white rounded-2xl p-4 shadow-sm border-l-4 border-blue-500 hover:shadow-md transition-all">
                            
                            <div v-if="selectedDayIndex === 0 && index === 0 && item.type === 'flight'" class="bg-blue-50 rounded-xl p-3 mb-2 border border-blue-100">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-2xl font-bold text-blue-800">{{ item.flightCode }}</span>
                                    <span class="text-xs bg-blue-600 text-white px-2 py-0.5 rounded">FLIGHT</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <div class="text-center">
                                        <div class="font-bold text-xl">{{ item.depTime }}</div>
                                        <div class="text-slate-400 text-xs">{{ item.depAirport }}</div>
                                    </div>
                                    <div class="flex flex-col justify-center items-center text-slate-300">
                                        <i class="fas fa-plane"></i>
                                        <div class="w-12 h-px bg-slate-300 my-1"></div>
                                        <span class="text-[10px]">{{ item.duration }}</span>
                                    </div>
                                    <div class="text-center">
                                        <div class="font-bold text-xl">{{ item.arrTime }}</div>
                                        <div class="text-slate-400 text-xs">{{ item.arrAirport }}</div>
                                    </div>
                                </div>
                            </div>

                            <div v-else>
                                <div class="flex justify-between items-start mb-2">
                                    <div class="flex items-center">
                                        <div :class="['w-8 h-8 rounded-full flex items-center justify-center text-white mr-3 text-sm', getTypeColor(item.type)]">
                                            <i :class="getTypeIcon(item.type)"></i>
                                        </div>
                                        <div>
                                            <h3 class="font-bold text-slate-800 text-lg">{{ item.name }}</h3>
                                            <p v-if="item.openTime" class="text-xs text-slate-400">
                                                <i class="far fa-clock mr-1"></i>{{ item.openTime }}
                                            </p>
                                        </div>
                                    </div>
                                    <div class="flex space-x-1 opacity-100 sm:opacity-0 group-hover:opacity-100 transition-opacity">
                                        <button @click="moveItem(index, -1)" class="text-slate-300 hover:text-blue-500 p-1"><i class="fas fa-chevron-up"></i></button>
                                        <button @click="moveItem(index, 1)" class="text-slate-300 hover:text-blue-500 p-1"><i class="fas fa-chevron-down"></i></button>
                                        <button @click="editItem(item)" class="text-slate-300 hover:text-blue-500 p-1"><i class="fas fa-pen"></i></button>
                                    </div>
                                </div>

                                <div class="pl-11 space-y-1">
                                    <div v-if="item.ticket" class="text-xs text-orange-500 font-medium">
                                        <i class="fas fa-ticket-alt mr-1"></i>門票: {{ item.ticket }}
                                    </div>
                                    <p class="text-sm text-slate-500 leading-relaxed bg-slate-50 p-2 rounded-lg">
                                        {{ item.notes }}
                                    </p>
                                    
                                    <a :href="'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(item.name)" target="_blank" class="inline-flex items-center mt-2 text-xs text-blue-500 font-bold hover:underline">
                                        <i class="fas fa-location-arrow mr-1"></i> 導航前往
                                    </a>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
                <div class="h-20"></div>
            </div>

            <div v-if="currentTab === 'info'" class="space-y-6 animate-fade-in">
                
                <div class="bg-white rounded-2xl p-5 shadow-sm">
                    <h3 class="font-bold text-slate-700 mb-3 border-l-4 border-yellow-400 pl-2">匯率換算 (JPY to TWD)</h3>
                    <div class="flex items-center space-x-2 bg-slate-50 p-3 rounded-xl border border-slate-200">
                        <div class="flex-1">
                            <label class="text-xs text-slate-400 block">日幣 (JPY)</label>
                            <input type="number" v-model="calcJpy" class="w-full bg-transparent font-mono text-xl outline-none font-bold text-slate-700" placeholder="0">
                        </div>
                        <i class="fas fa-exchange-alt text-slate-400"></i>
                        <div class="flex-1 text-right">
                            <label class="text-xs text-slate-400 block">台幣 (TWD)</label>
                            <div class="font-mono text-xl font-bold text-blue-600">{{ calculatedTwd }}</div>
                        </div>
                    </div>
                    <div class="text-right text-xs text-slate-400 mt-1">匯率約: {{ exchangeRate }}</div>
                </div>

                <div class="bg-white rounded-2xl shadow-sm overflow-hidden">
                    <div class="bg-blue-600 text-white p-3 font-bold text-center">航班資訊</div>
                    <div class="p-4 space-y-4">
                        <div class="border-b border-slate-100 pb-3">
                            <div class="flex justify-between items-center mb-1">
                                <span class="badge bg-green-100 text-green-700 text-xs px-2 py-1 rounded">去程</span>
                                <span class="font-mono text-slate-500">BR-116</span>
                            </div>
                            <div class="flex justify-between items-center text-center">
                                <div>
                                    <div class="text-2xl font-bold">09:30</div>
                                    <div class="text-xs text-slate-500">TPE</div>
                                </div>
                                <div class="flex-1 px-2 text-xs text-slate-400 flex flex-col items-center">
                                    <span>3h 35m</span>
                                    <div class="w-full h-px bg-slate-300 relative my-1">
                                        <i class="fas fa-plane absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white px-1"></i>
                                    </div>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold">14:05</div>
                                    <div class="text-xs text-slate-500">CTS</div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between items-center mb-1">
                                <span class="badge bg-orange-100 text-orange-700 text-xs px-2 py-1 rounded">回程</span>
                                <span class="font-mono text-slate-500">BR-115</span>
                            </div>
                            <div class="flex justify-between items-center text-center">
                                <div>
                                    <div class="text-2xl font-bold">15:20</div>
                                    <div class="text-xs text-slate-500">CTS</div>
                                </div>
                                <div class="flex-1 px-2 text-xs text-slate-400 flex flex-col items-center">
                                    <span>4h 10m</span>
                                    <div class="w-full h-px bg-slate-300 relative my-1">
                                        <i class="fas fa-plane rotate-180 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white px-1"></i>
                                    </div>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold">18:30</div>
                                    <div class="text-xs text-slate-500">TPE</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <a href="https://maps.google.com/?q=Hotel+Name" target="_blank" class="bg-white p-4 rounded-2xl shadow-sm hover:bg-blue-50 transition text-center">
                        <i class="fas fa-hotel text-3xl text-blue-500 mb-2"></i>
                        <h4 class="font-bold text-sm">住宿資訊</h4>
                        <p class="text-xs text-slate-400">查看詳細</p>
                    </a>
                    <a href="https://maps.google.com/?q=Car+Rental" target="_blank" class="bg-white p-4 rounded-2xl shadow-sm hover:bg-blue-50 transition text-center">
                        <i class="fas fa-car text-3xl text-green-500 mb-2"></i>
                        <h4 class="font-bold text-sm">租車資訊</h4>
                        <p class="text-xs text-slate-400">導航取車</p>
                    </a>
                </div>
                 <div class="bg-red-50 rounded-2xl p-4 border border-red-100">
                    <h3 class="font-bold text-red-700 text-sm mb-2"><i class="fas fa-exclamation-circle mr-1"></i>緊急醫療</h3>
                    <div class="flex justify-around text-center">
                        <div><div class="text-2xl font-bold text-red-600">110</div><div class="text-xs">警察</div></div>
                        <div><div class="text-2xl font-bold text-red-600">119</div><div class="text-xs">救護車</div></div>
                    </div>
                 </div>
            </div>

            <div v-if="currentTab === 'shopping'" class="animate-fade-in">
                <div class="grid grid-cols-2 gap-4">
                    <div v-for="(item, idx) in shoppingList" :key="idx" class="bg-white rounded-2xl overflow-hidden shadow-sm relative group">
                        <div class="h-32 bg-slate-200 relative">
                            <img v-if="item.image" :src="item.image" class="w-full h-full object-cover">
                            <div v-else class="w-full h-full flex items-center justify-center text-slate-400">
                                <i class="fas fa-image text-2xl"></i>
                            </div>
                            <button @click="removeShoppingItem(idx)" class="absolute top-2 right-2 bg-red-500 text-white w-6 h-6 rounded-full text-xs shadow-md"><i class="fas fa-times"></i></button>
                        </div>
                        <div class="p-3">
                            <h4 class="font-bold text-slate-700">{{ item.name }}</h4>
                            <div class="flex items-center mt-2">
                                <input type="checkbox" v-model="item.bought" class="w-4 h-4 text-blue-600 rounded">
                                <span class="ml-2 text-xs text-slate-500" :class="{'line-through': item.bought}">已購買</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'expense'" class="animate-fade-in">
                <div class="bg-gradient-to-br from-slate-800 to-slate-700 rounded-2xl p-5 text-white shadow-lg mb-6">
                    <div class="text-sm opacity-70">旅費總支出 (JPY)</div>
                    <div class="text-4xl font-mono font-bold mt-1">¥ {{ totalExpense.toLocaleString() }}</div>
                    <div class="mt-4 flex space-x-2 overflow-x-auto no-scrollbar">
                        <span class="text-xs bg-white/20 px-2 py-1 rounded">現金: ¥{{ expenseSummary.cash.toLocaleString() }}</span>
                        <span class="text-xs bg-white/20 px-2 py-1 rounded">信用卡: ¥{{ expenseSummary.card.toLocaleString() }}</span>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-sm overflow-hidden">
                    <div v-for="(exp, idx) in sortedExpenses" :key="idx" class="flex justify-between items-center p-4 border-b border-slate-100 last:border-0">
                        <div class="flex items-center">
                            <div :class="['w-10 h-10 rounded-full flex items-center justify-center text-white mr-3', getCategoryColor(exp.category)]">
                                <i :class="getCategoryIcon(exp.category)"></i>
                            </div>
                            <div>
                                <div class="font-bold text-slate-700">{{ exp.name }}</div>
                                <div class="text-xs text-slate-400">{{ exp.date }} · {{ exp.payment }}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-mono font-bold text-slate-700">¥{{ exp.amount }}</div>
                            <div class="text-xs text-slate-400">{{ exp.category }}</div>
                        </div>
                    </div>
                </div>
            </div>

        </main>

        <button v-if="currentTab !== 'info'" @click="openAddModal" 
            class="fixed bottom-6 right-6 w-14 h-14 bg-blue-600 text-white rounded-full shadow-lg shadow-blue-400/50 flex items-center justify-center text-2xl active:scale-95 transition-transform z-50">
            <i class="fas fa-plus"></i>
        </button>

        <div v-if="showItineraryModal" class="fixed inset-0 bg-black/50 z-50 flex items-end sm:items-center justify-center p-0 sm:p-4 backdrop-blur-sm">
            <div class="bg-white w-full max-w-md rounded-t-3xl sm:rounded-2xl p-6 shadow-2xl animate-slide-up">
                <h3 class="text-xl font-bold mb-4">{{ isEditing ? '編輯行程' : '新增行程' }}</h3>
                
                <div class="space-y-3 max-h-[70vh] overflow-y-auto pr-1">
                    <select v-model="formItinerary.type" class="w-full p-3 bg-slate-50 rounded-xl border border-slate-200">
                        <option value="spot">景點</option>
                        <option value="food">美食</option>
                        <option value="shopping">購物</option>
                        <option value="hotel">住宿</option>
                        <option value="flight">航班</option>
                        <option value="other">其他</option>
                    </select>
                    <input v-model="formItinerary.name" placeholder="名稱 (必填)" class="w-full p-3 bg-slate-50 rounded-xl border border-slate-200">
                    <div class="flex space-x-2">
                         <input v-model="formItinerary.openTime" placeholder="營業時間" class="w-1/2 p-3 bg-slate-50 rounded-xl border border-slate-200 text-sm">
                         <input v-model="formItinerary.ticket" placeholder="門票費用" class="w-1/2 p-3 bg-slate-50 rounded-xl border border-slate-200 text-sm">
                    </div>
                    
                    <div class="bg-blue-50 p-3 rounded-xl">
                        <label class="text-xs text-blue-600 font-bold mb-2 block">前往此處的交通 (從上一點出發)</label>
                        <div class="flex space-x-2 mb-2">
                             <select v-model="formItinerary.transportType" class="w-1/2 p-2 rounded-lg border border-blue-200 text-sm">
                                <option value="walk">步行</option>
                                <option value="drive">開車</option>
                                <option value="transit">大眾運輸</option>
                             </select>
                             <input v-model="formItinerary.transportTime" placeholder="預估時間 (如: 15min)" class="w-1/2 p-2 rounded-lg border border-blue-200 text-sm">
                        </div>
                    </div>

                    <textarea v-model="formItinerary.notes" placeholder="備註、特色..." class="w-full p-3 bg-slate-50 rounded-xl border border-slate-200 h-24"></textarea>
                </div>

                <div class="flex space-x-3 mt-6">
                    <button v-if="isEditing" @click="confirmDelete" class="flex-1 bg-red-100 text-red-500 py-3 rounded-xl font-bold">刪除</button>
                    <button @click="showItineraryModal = false" class="flex-1 bg-slate-100 text-slate-500 py-3 rounded-xl font-bold">取消</button>
                    <button @click="saveItinerary" class="flex-1 bg-blue-600 text-white py-3 rounded-xl font-bold">儲存</button>
                </div>
            </div>
        </div>

        <div v-if="showShoppingModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
            <div class="bg-white w-full max-w-md rounded-2xl p-6">
                <h3 class="text-xl font-bold mb-4">新增購物清單</h3>
                <input v-model="formShopping.name" placeholder="商品名稱" class="w-full p-3 bg-slate-50 rounded-xl mb-3 border">
                <div class="relative border-2 border-dashed border-slate-300 rounded-xl p-6 text-center mb-4">
                    <input type="file" @change="handleImageUpload" class="absolute inset-0 opacity-0 cursor-pointer">
                    <i class="fas fa-camera text-2xl text-slate-400 mb-2"></i>
                    <p class="text-xs text-slate-500">點擊上傳圖片</p>
                    <img v-if="formShopping.image" :src="formShopping.image" class="absolute inset-0 w-full h-full object-cover rounded-xl">
                </div>
                <div class="flex space-x-3">
                    <button @click="showShoppingModal = false" class="flex-1 bg-slate-100 py-3 rounded-xl">取消</button>
                    <button @click="saveShopping" class="flex-1 bg-blue-600 text-white py-3 rounded-xl">加入</button>
                </div>
            </div>
        </div>

        <div v-if="showExpenseModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
            <div class="bg-white w-full max-w-md rounded-2xl p-6">
                <h3 class="text-xl font-bold mb-4">記帳</h3>
                <div class="grid grid-cols-2 gap-3 mb-3">
                    <select v-model="formExpense.category" class="p-3 bg-slate-50 rounded-xl border">
                        <option value="飲食">飲食</option>
                        <option value="交通">交通</option>
                        <option value="住宿">住宿</option>
                        <option value="購物">購物</option>
                        <option value="門票">門票</option>
                        <option value="其他">其他</option>
                    </select>
                    <input type="date" v-model="formExpense.date" class="p-3 bg-slate-50 rounded-xl border">
                </div>
                <input v-model="formExpense.name" placeholder="項目名稱" class="w-full p-3 bg-slate-50 rounded-xl mb-3 border">
                <input type="number" v-model="formExpense.amount" placeholder="金額 (JPY)" class="w-full p-3 bg-slate-50 rounded-xl mb-3 border font-mono">
                <div class="flex space-x-3 mb-4">
                    <label class="flex-1 p-3 border rounded-xl flex items-center justify-center cursor-pointer" :class="{'bg-blue-50 border-blue-500': formExpense.payment === '現金'}">
                        <input type="radio" value="現金" v-model="formExpense.payment" class="hidden"> 現金
                    </label>
                    <label class="flex-1 p-3 border rounded-xl flex items-center justify-center cursor-pointer" :class="{'bg-blue-50 border-blue-500': formExpense.payment === '信用卡'}">
                        <input type="radio" value="信用卡" v-model="formExpense.payment" class="hidden"> 信用卡
                    </label>
                </div>
                <div class="flex space-x-3">
                    <button @click="showExpenseModal = false" class="flex-1 bg-slate-100 py-3 rounded-xl">取消</button>
                    <button @click="saveExpense" class="flex-1 bg-blue-600 text-white py-3 rounded-xl">儲存</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue;

        createApp({
            setup() {
                // 模擬 banner，請換成你的 XXX 圖片路徑
                const bannerImage = ref('https://via.placeholder.com/1920x400/93C5FD/FFFFFF?text=HOKKAIDO+TRIP');
                const currentTab = ref('itinerary');
                const selectedDayIndex = ref(0);
                const filterType = ref('all');
                const exchangeRate = ref(0.22); // 匯率
                const calcJpy = ref('');

                // 模態框控制
                const showItineraryModal = ref(false);
                const showShoppingModal = ref(false);
                const showExpenseModal = ref(false);
                const isEditing = ref(false);
                const editTargetId = ref(null);

                // 資料結構：日期
                const tripDays = ref([
                    { date: '6', weekday: 'Fri' },
                    { date: '7', weekday: 'Sat' },
                    { date: '8', weekday: 'Sun' },
                    { date: '9', weekday: 'Mon' },
                    { date: '10', weekday: 'Tue' }
                ]);

                // 資料結構：行程 (包含預設資料)
                const itineraryData = ref({
                    0: [ // Day 1
                        { id: 1, type: 'flight', name: '出發航班', flightCode: 'BR-116', depTime: '09:30', depAirport: 'TPE', arrTime: '14:05', arrAirport: 'CTS', duration: '3h 35m', transportType: 'drive', transportTime: '40min', notes: '記得提早兩小時到機場' },
                        { id: 2, type: 'spot', name: '新千歲機場 哆啦A夢空中樂園', openTime: '10:00-18:00', ticket: '800円', transportType: 'drive', transportTime: '50min', notes: '位於國內線航廈3F' },
                        { id: 3, type: 'hotel', name: '登別溫泉飯店', openTime: 'Check-in 15:00', ticket: '', transportType: 'drive', transportTime: '-', notes: '含晚餐懷石料理' }
                    ],
                    1: [], // Day 2
                    2: [], // Day 3
                    3: [], // Day 4
                    4: []  // Day 5
                });

                // 資料結構：購物清單
                const shoppingList = ref([
                    { name: '白色戀人', bought: false, image: '' },
                    { name: '六花亭奶油夾心', bought: false, image: '' }
                ]);

                // 資料結構：花費
                const expenses = ref([
                    { category: '交通', name: '租車費用', date: '2025-02-06', amount: 35000, payment: '信用卡' },
                    { category: '飲食', name: '機場拉麵', date: '2025-02-06', amount: 2400, payment: '現金' }
                ]);

                // 表單模型
                const formItinerary = ref({ type: 'spot', name: '', openTime: '', ticket: '', notes: '', transportType: 'drive', transportTime: '' });
                const formShopping = ref({ name: '', image: '' });
                const formExpense = ref({ category: '飲食', name: '', amount: '', payment: '現金', date: new Date().toISOString().split('T')[0] });

                // Tabs 定義
                const tabs = [
                    { id: 'itinerary', name: '行程', icon: 'fas fa-map-marked-alt' },
                    { id: 'info', name: '資訊', icon: 'fas fa-info-circle' },
                    { id: 'shopping', name: '購物', icon: 'fas fa-shopping-basket' },
                    { id: 'expense', name: '花費', icon: 'fas fa-yen-sign' }
                ];

                // 天氣 Mock Data
                const weatherData = computed(() => {
                    const weathers = [
                        { temp: 2, feelsLike: -3, icon: 'fas fa-snowflake', desc: '小雪', location: '札幌' },
                        { temp: 5, feelsLike: 1, icon: 'fas fa-cloud-sun', desc: '多雲', location: '小樽' },
                        { temp: -1, feelsLike: -5, icon: 'fas fa-wind', desc: '強風', location: '登別' }
                    ];
                    return weathers[selectedDayIndex.value % weathers.length];
                });

                // 計算屬性
                const filteredItinerary = computed(() => {
                    const list = itineraryData.value[selectedDayIndex.value] || [];
                    if (filterType.value === 'all') return list;
                    return list.filter(item => item.type === filterType.value);
                });

                const calculatedTwd = computed(() => {
                    if (!calcJpy.value) return 0;
                    return (calcJpy.value * exchangeRate.value).toFixed(0);
                });

                const totalExpense = computed(() => expenses.value.reduce((sum, item) => sum + Number(item.amount), 0));
                
                const expenseSummary = computed(() => {
                    return expenses.value.reduce((acc, curr) => {
                        if (curr.payment === '現金') acc.cash += Number(curr.amount);
                        else acc.card += Number(curr.amount);
                        return acc;
                    }, { cash: 0, card: 0 });
                });

                const sortedExpenses = computed(() => {
                    return [...expenses.value].sort((a, b) => new Date(b.date) - new Date(a.date));
                });

                // 方法
                const getTransportIcon = (type) => {
                    const map = { walk: 'fas fa-walking', drive: 'fas fa-car', transit: 'fas fa-bus' };
                    return map[type] || 'fas fa-car';
                };

                const getTypeIcon = (type) => {
                    const map = { spot: 'fas fa-camera', food: 'fas fa-utensils', shopping: 'fas fa-shopping-bag', hotel: 'fas fa-bed', flight: 'fas fa-plane', other: 'fas fa-star' };
                    return map[type] || 'fas fa-map-pin';
                };

                const getTypeColor = (type) => {
                    const map = { spot: 'bg-green-500', food: 'bg-orange-500', shopping: 'bg-pink-500', hotel: 'bg-indigo-500', flight: 'bg-blue-500', other: 'bg-slate-500' };
                    return map[type];
                };

                const getCategoryIcon = (cat) => {
                    const map = { '交通': 'fas fa-subway', '飲食': 'fas fa-hamburger', '住宿': 'fas fa-hotel', '購物': 'fas fa-shopping-bag', '門票': 'fas fa-ticket-alt', '其他': 'fas fa-ellipsis-h' };
                    return map[cat] || 'fas fa-yen-sign';
                };

                const getCategoryColor = (cat) => {
                    const map = { '交通': 'bg-blue-400', '飲食': 'bg-orange-400', '住宿': 'bg-purple-400', '購物': 'bg-pink-400', '門票': 'bg-green-400', '其他': 'bg-gray-400' };
                    return map[cat];
                };

                // 行程操作
                const openAddModal = () => {
                    if (currentTab.value === 'itinerary') {
                        isEditing.value = false;
                        formItinerary.value = { type: 'spot', name: '', openTime: '', ticket: '', notes: '', transportType: 'drive', transportTime: '' };
                        showItineraryModal.value = true;
                    } else if (currentTab.value === 'shopping') {
                        formShopping.value = { name: '', image: '' };
                        showShoppingModal.value = true;
                    } else if (currentTab.value === 'expense') {
                        formExpense.value = { category: '飲食', name: '', amount: '', payment: '現金', date: new Date().toISOString().split('T')[0] };
                        showExpenseModal.value = true;
                    }
                };

                const editItem = (item) => {
                    isEditing.value = true;
                    editTargetId.value = item.id;
                    formItinerary.value = { ...item };
                    showItineraryModal.value = true;
                };

                const saveItinerary = () => {
                    const list = itineraryData.value[selectedDayIndex.value] || [];
                    if (isEditing.value) {
                        const idx = list.findIndex(i => i.id === editTargetId.value);
                        if (idx !== -1) list[idx] = { ...formItinerary.value, id: editTargetId.value };
                    } else {
                        if (!itineraryData.value[selectedDayIndex.value]) itineraryData.value[selectedDayIndex.value] = [];
                        itineraryData.value[selectedDayIndex.value].push({ ...formItinerary.value, id: Date.now() });
                    }
                    saveToLocal();
                    showItineraryModal.value = false;
                };

                const confirmDelete = () => {
                    if (confirm('確定要刪除這個行程嗎？')) {
                        const list = itineraryData.value[selectedDayIndex.value];
                        const idx = list.findIndex(i => i.id === editTargetId.value);
                        if (idx !== -1) list.splice(idx, 1);
                        saveToLocal();
                        showItineraryModal.value = false;
                    }
                };

                const moveItem = (index, direction) => {
                    const list = itineraryData.value[selectedDayIndex.value];
                    if (index + direction < 0 || index + direction >= list.length) return;
                    // Swap
                    [list[index], list[index + direction]] = [list[index + direction], list[index]];
                    saveToLocal();
                };

                // 購物與花費操作
                const handleImageUpload = (event) => {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => formShopping.value.image = e.target.result;
                        reader.readAsDataURL(file);
                    }
                };

                const saveShopping = () => {
                    shoppingList.value.push({ ...formShopping.value });
                    saveToLocal();
                    showShoppingModal.value = false;
                };

                const removeShoppingItem = (index) => {
                    shoppingList.value.splice(index, 1);
                    saveToLocal();
                };

                const saveExpense = () => {
                    expenses.value.push({ ...formExpense.value });
                    saveToLocal();
                    showExpenseModal.value = false;
                };

                // LocalStorage
                const saveToLocal = () => {
                    localStorage.setItem('hokkaido_trip_data', JSON.stringify({
                        itinerary: itineraryData.value,
                        shopping: shoppingList.value,
                        expenses: expenses.value
                    }));
                };

                onMounted(() => {
                    const saved = localStorage.getItem('hokkaido_trip_data');
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        itineraryData.value = parsed.itinerary || itineraryData.value;
                        shoppingList.value = parsed.shopping || [];
                        expenses.value = parsed.expenses || [];
                    }
                });

                return {
                    bannerImage, currentTab, tabs, tripDays, selectedDayIndex, filterType,
                    weatherData, filteredItinerary,
                    itineraryData, showItineraryModal, isEditing, formItinerary, openAddModal, editItem, saveItinerary, confirmDelete, moveItem,
                    getTransportIcon, getTypeIcon, getTypeColor,
                    // Info
                    exchangeRate, calcJpy, calculatedTwd,
                    // Shopping
                    shoppingList, showShoppingModal, formShopping, handleImageUpload, saveShopping, removeShoppingItem,
                    // Expense
                    expenses, sortedExpenses, showExpenseModal, formExpense, saveExpense, totalExpense, expenseSummary,
                    getCategoryIcon, getCategoryColor
                };
            }
        }).mount('#app');
    </script>
    
    <style>
        /* CSS Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(100%); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-up {
            animation: slideUp 0.3s ease-out forwards;
        }
    </style>
</body>
</html>